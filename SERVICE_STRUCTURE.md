# ã‚µãƒ¼ãƒ“ã‚¹æ§‹é€ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

å„Webã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGmailã€Slackã€Notionï¼‰ã®æ“ä½œã‚’å®šå‹åŒ–ã—ã€ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã®è¿½åŠ ã¯æƒ³å®šã—ã¦ã„ã¾ã›ã‚“ã€‚

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
lib/services/
â”œâ”€â”€ types.ts                    # å…±é€šå‹å®šç¾©
â”œâ”€â”€ index.ts                    # ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
â”œâ”€â”€ gmail/
â”‚   â”œâ”€â”€ index.ts               # Gmail ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©
â”‚   â””â”€â”€ actions.ts             # Gmail ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
â”œâ”€â”€ slack/
â”‚   â”œâ”€â”€ index.ts               # Slack ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©
â”‚   â””â”€â”€ actions.ts             # Slack ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
â””â”€â”€ notion/
    â”œâ”€â”€ index.ts               # Notion ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©
    â””â”€â”€ actions.ts             # Notion ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
```

## ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©æ§‹é€ 

### ServiceDefinition

å„ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»¥ä¸‹ã®æ§‹é€ ã‚’æŒã¡ã¾ã™ï¼š

```typescript
interface ServiceDefinition {
  id: string;                    // ã‚µãƒ¼ãƒ“ã‚¹IDï¼ˆgmail, slack, notionï¼‰
  name: string;                  // è¡¨ç¤ºå
  description: string;           // èª¬æ˜
  icon?: string;                 // ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆçµµæ–‡å­—ï¼‰
  actions: ServiceAction[];      // åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  settings?: {                   // ã‚µãƒ¼ãƒ“ã‚¹å›ºæœ‰ã®è¨­å®š
    [key: string]: {
      type: 'string' | 'number' | 'boolean';
      required: boolean;
      description: string;
      default?: any;
    };
  };
}
```

### ServiceAction

å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®æ§‹é€ ã‚’æŒã¡ã¾ã™ï¼š

```typescript
interface ServiceAction {
  id: string;                    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ID
  name: string;                  // è¡¨ç¤ºå
  description: string;           // èª¬æ˜
  parameters: ActionParameter[]; // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
  execute: (context: BrowserContext, params: Record<string, any>) => Promise<any>;
}

interface ActionParameter {
  name: string;                  // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å
  type: 'string' | 'number' | 'boolean' | 'array' | 'object';
  required: boolean;             // å¿…é ˆã‹ã©ã†ã‹
  description: string;           // èª¬æ˜
  default?: any;                 // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
}
```

## ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹

### 1. Gmail (ğŸ“§)

**ã‚µãƒ¼ãƒ“ã‚¹ID**: `gmail`

#### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

##### send_email - ãƒ¡ãƒ¼ãƒ«é€ä¿¡
Gmailã§ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `to` (string, å¿…é ˆ): å®›å…ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `subject` (string, å¿…é ˆ): ä»¶å
- `body` (string, å¿…é ˆ): æœ¬æ–‡
- `cc` (string, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): CCãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- `bcc` (string, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): BCCãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

**å®Ÿè¡Œä¾‹**:
```typescript
{
  serviceId: "gmail-12345",
  actionId: "send_email",
  parameters: {
    to: "example@example.com",
    subject: "ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«",
    body: "ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«ã§ã™",
    cc: "cc@example.com"
  }
}
```

##### read_emails - ãƒ¡ãƒ¼ãƒ«ä¸€è¦§å–å¾—
å—ä¿¡ãƒˆãƒ¬ã‚¤ã®ãƒ¡ãƒ¼ãƒ«ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `limit` (number, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
- `unreadOnly` (boolean, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): æœªèª­ã®ã¿å–å¾—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰

**å®Ÿè¡Œä¾‹**:
```typescript
{
  serviceId: "gmail-12345",
  actionId: "read_emails",
  parameters: {
    limit: 20,
    unreadOnly: true
  }
}
```

##### search_emails - ãƒ¡ãƒ¼ãƒ«æ¤œç´¢
ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ãƒ¡ãƒ¼ãƒ«ã‚’æ¤œç´¢ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `query` (string, å¿…é ˆ): æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- `limit` (number, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰

---

### 2. Slack (ğŸ’¬)

**ã‚µãƒ¼ãƒ“ã‚¹ID**: `slack`

**å¿…é ˆè¨­å®š**:
- `workspace`: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åï¼ˆä¾‹: my-workspaceï¼‰

#### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

##### send_message - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
Slackãƒãƒ£ãƒ³ãƒãƒ«ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `channel` (string, å¿…é ˆ): ãƒãƒ£ãƒ³ãƒãƒ«åï¼ˆ#general ãªã©ï¼‰
- `message` (string, å¿…é ˆ): é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `thread` (boolean, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¿”ä¿¡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰

**å®Ÿè¡Œä¾‹**:
```typescript
{
  serviceId: "slack-12345",
  actionId: "send_message",
  parameters: {
    channel: "#general",
    message: "ã“ã‚“ã«ã¡ã¯ï¼"
  }
}
```

##### read_messages - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—
ãƒãƒ£ãƒ³ãƒãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `channel` (string, å¿…é ˆ): ãƒãƒ£ãƒ³ãƒãƒ«å
- `limit` (number, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰

##### search_workspace - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ¤œç´¢
ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å…¨ä½“ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¤œç´¢ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `query` (string, å¿…é ˆ): æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- `limit` (number, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰

---

### 3. Notion (ğŸ“)

**ã‚µãƒ¼ãƒ“ã‚¹ID**: `notion`

#### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

##### create_page - ãƒšãƒ¼ã‚¸ä½œæˆ
æ–°ã—ã„Notionãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `title` (string, å¿…é ˆ): ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«
- `content` (string, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): ãƒšãƒ¼ã‚¸æœ¬æ–‡
- `emoji` (string, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): ãƒšãƒ¼ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆçµµæ–‡å­—ï¼‰

**å®Ÿè¡Œä¾‹**:
```typescript
{
  serviceId: "notion-12345",
  actionId: "create_page",
  parameters: {
    title: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨ˆç”»",
    content: "ä»Šé€±ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§",
    emoji: "ğŸ“‹"
  }
}
```

##### search_pages - ãƒšãƒ¼ã‚¸æ¤œç´¢
Notionãƒšãƒ¼ã‚¸ã‚’æ¤œç´¢ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `query` (string, å¿…é ˆ): æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- `limit` (number, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ï¼‰

##### create_database - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
æ–°ã—ã„Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `title` (string, å¿…é ˆ): ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¿ã‚¤ãƒˆãƒ«
- `properties` (array, ã‚ªãƒ—ã‚·ãƒ§ãƒ³): ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®šç¾©ï¼ˆåå‰ã¨å‹ã®é…åˆ—ï¼‰

##### add_database_row - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¡Œè¿½åŠ 
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ–°ã—ã„è¡Œã‚’è¿½åŠ ã—ã¾ã™

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `databaseUrl` (string, å¿…é ˆ): ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®URL
- `data` (object, å¿…é ˆ): è¡Œã®ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨å€¤ï¼‰

---

## ä½¿ç”¨æ–¹æ³•

### APIçµŒç”±ã§å®Ÿè¡Œ

```bash
curl -X POST http://localhost:3000/api/tasks/execute \
  -H "Content-Type: application/json" \
  -d '{
    "serviceId": "gmail-12345",
    "actionId": "send_email",
    "parameters": {
      "to": "example@example.com",
      "subject": "ãƒ†ã‚¹ãƒˆ",
      "body": "ã“ã‚“ã«ã¡ã¯"
    }
  }'
```

### MCP ServerçµŒç”±ã§å®Ÿè¡Œ

```typescript
// Claude Code CLIã‹ã‚‰
{
  tool: "execute_task",
  arguments: {
    serviceId: "gmail-12345",
    actionId: "send_email",
    parameters: {
      to: "example@example.com",
      subject: "ãƒ†ã‚¹ãƒˆ",
      body: "ã“ã‚“ã«ã¡ã¯"
    }
  }
}
```

### åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’å–å¾—

```bash
# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å–å¾—
curl http://localhost:3000/api/services/actions?type=gmail

# ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ï¼ˆMCPï¼‰
{
  tool: "list_all_services"
}

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°ï¼ˆMCPï¼‰
{
  tool: "list_service_actions",
  arguments: {
    serviceType: "gmail"
  }
}
```

## ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

1. **ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šã‚’ç¢ºèª**: ConfigStorageã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
2. **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©ã‚’å–å¾—**: ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—
3. **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼**: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
4. **ãƒ–ãƒ©ã‚¦ã‚¶ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ**: Playwrightã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹
5. **ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–**: ã‚µãƒ¼ãƒ“ã‚¹ã®Webã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
6. **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**: å®šç¾©ã•ã‚ŒãŸexecuteé–¢æ•°ã‚’å‘¼ã³å‡ºã—
7. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜**: ãƒ–ãƒ©ã‚¦ã‚¶ã®çŠ¶æ…‹ã‚’ä¿å­˜
8. **çµæœè¿”å´**: å®Ÿè¡Œçµæœã‚’è¿”ã™

## æ‹¡å¼µå¯èƒ½æ€§

ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã¯3ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGmailã€Slackã€Notionï¼‰ã«ç‰¹åŒ–ã—ã¦ã„ã¾ã™ã€‚æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã®è¿½åŠ ã¯æƒ³å®šã—ã¦ã„ã¾ã›ã‚“ãŒã€æ—¢å­˜ã‚µãƒ¼ãƒ“ã‚¹ã®æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã¯ä»¥ä¸‹ã®æ‰‹é †ã§å¯èƒ½ã§ã™ï¼š

### æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ æ–¹æ³•

1. **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©ã‚’è¿½åŠ **
   - `lib/services/{service}/actions.ts` ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

2. **å‹å®šç¾©ã«å¾“ã†**
   - `ServiceAction` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«æº–æ‹ 

3. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**
   - `{service}Actions` é…åˆ—ã«è¿½åŠ 

ä¾‹ï¼š
```typescript
export const newAction: ServiceAction = {
  id: 'new_action',
  name: 'æ–°ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
  description: 'èª¬æ˜',
  parameters: [
    // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©
  ],
  execute: async (context, params) => {
    // å®Ÿè£…
    return { success: true };
  },
};

export const gmailActions = [
  sendEmailAction,
  readEmailsAction,
  searchEmailsAction,
  newAction, // è¿½åŠ 
];
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```
Error: Action not found: invalid_action for service gmail
```

â†’ `lib/services/{service}/actions.ts` ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼

```
Error: Required parameter missing: to
```

â†’ å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ã‚µãƒ¼ãƒ“ã‚¹è¨­å®šãŒè¦‹ã¤ã‹ã‚‰ãªã„

```
Error: Service configuration not found: gmail-12345
```

â†’ è¨­å®šãƒšãƒ¼ã‚¸ã§ã‚µãƒ¼ãƒ“ã‚¹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

## ã¾ã¨ã‚

- âœ… 3ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGmailã€Slackã€Notionï¼‰å®Œå…¨å¯¾å¿œ
- âœ… åˆè¨ˆ11ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©
- âœ… å‹å®‰å…¨ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¤œè¨¼
- âœ… æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ï¼‰
- âœ… MCP Serverå®Œå…¨çµ±åˆ
